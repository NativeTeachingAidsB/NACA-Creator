Animate-Style Timeline Editor & Animation System - Development Plan
This document provides a comprehensive build plan for implementing an Adobe Animate-equivalent timeline-based animation system for the Activity Editor.

Executive Summary
We're building a timeline-based animation editor similar to Adobe Animate that allows:

Layer-based timeline with keyframe editing
Parent-child animation hierarchies
GSAP-powered playback with easing controls
Play/stop actions and zero-key defaults
Nested timeline orchestration
System Architecture Overview
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GameCanvas (Stage)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         Selected Object Hierarchy Display             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Timeline Editor Panel (Bottom)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Layer List  â”‚      Timeline Track & Keyframes      â”‚   â”‚
â”‚  â”‚  (Tree)      â”‚                                       â”‚   â”‚
â”‚  â”‚  - Object A  â”‚  â—â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â—    â”‚   â”‚
â”‚  â”‚    - Child B â”‚    â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â—                       â”‚   â”‚
â”‚  â”‚    - Child C â”‚       â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  [Playhead Controls] [Frame Ruler] [Animation Properties]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Database Schema Extensions
New Tables Required
1. animations - Timeline container for each object

{
  id: string (uuid)
  objectId: string (references gameObjects.id)
  sceneId: string (references scenes.id, nullable for master timeline)
  duration: number (in seconds)
  loop: boolean
  autoplay: boolean
  playbackRate: number
  createdAt: timestamp
}
2. keyframes - Individual animation keyframes

{
  id: string (uuid)
  animationId: string (references animations.id)
  time: number (in seconds from animation start)
  property: string (x, y, rotation, scaleX, scaleY, opacity, etc.)
  value: number | string
  ease: string (GSAP easing function)
  createdAt: timestamp
}
3. timeline_actions - Play/stop triggers on timeline

{
  id: string (uuid)
  animationId: string (parent timeline)
  targetAnimationId: string (child timeline to control)
  action: 'play' | 'stop' | 'pause' | 'restart' | 'gotoAndPlay' | 'gotoAndStop'
  triggerTime: number (when in parent timeline)
  targetFrame: number (for goto actions, nullable)
  createdAt: timestamp
}
Development Phases
Phase 1: Data Layer & API âš¡ HIGH PRIORITY
Duration: 2-3 days

1.1 Database Schema Migration
Create migration for animations, keyframes, timeline_actions tables
Add indices for performance (objectId, sceneId, animationId)
Add foreign key constraints with cascade deletes
1.2 Storage Service Updates
createAnimation(data) - Create timeline for object
updateAnimation(id, data) - Update timeline properties
deleteAnimation(id) - Delete timeline and cascade keyframes
createKeyframe(data) - Add keyframe to timeline
updateKeyframe(id, data) - Modify keyframe properties
deleteKeyframe(id) - Remove keyframe
getKeyframesByAnimation(animationId) - Fetch all keyframes
createTimelineAction(data) - Add child timeline control
updateTimelineAction(id, data) - Modify action
deleteTimelineAction(id) - Remove action
getTimelineActionsByAnimation(animationId) - Fetch actions
1.3 REST API Routes
POST   /api/animations
PATCH  /api/animations/:id
DELETE /api/animations/:id
GET    /api/objects/:objectId/animations
POST   /api/keyframes
PATCH  /api/keyframes/:id
DELETE /api/keyframes/:id
GET    /api/animations/:animationId/keyframes
POST   /api/timeline-actions
PATCH  /api/timeline-actions/:id
DELETE /api/timeline-actions/:id
GET    /api/animations/:animationId/actions
Phase 2: Timeline UI Components âš¡ HIGH PRIORITY
Duration: 4-5 days

2.1 Timeline Panel Container
File: client/src/components/editor/TimelinePanel.tsx

Features:

Resizable drawer from bottom (100-400px height)
Collapse/expand with animation
Split view: Layer tree (200px) + Timeline track (remaining width)
Playhead controls toolbar
Frame ruler with time indicators
2.2 Layer Tree Component
File: client/src/components/editor/LayerTree.tsx

Features:

Hierarchical object tree (selected object + children)
Expand/collapse nested objects
Layer visibility toggles
Layer lock toggles
Color-coded layer types
Selected layer highlight
2.3 Timeline Track Component
File: client/src/components/editor/TimelineTrack.tsx

Features:

Horizontal scrollable timeline grid
Frame ruler with second/frame markers
Zoom controls (10fps to 60fps display)
Playhead scrubber (draggable)
Multi-layer track display
2.4 Keyframe Display Component
File: client/src/components/editor/KeyframeLayer.tsx

Features:

Keyframe diamonds on timeline
Property-grouped keyframes (position, rotation, scale, opacity)
Drag keyframes to reposition
Right-click context menu (delete, copy, paste)
Bezier curve visualization between keyframes
Selected keyframe highlight
2.5 Playhead Controls
File: client/src/components/editor/PlayheadControls.tsx

Features:

Play/Pause button
Stop button (reset to frame 0)
Step forward/backward (1 frame)
Loop toggle
Playback speed selector (0.25x, 0.5x, 1x, 2x)
Current time display (00:00.000)
Phase 3: Keyframe Editing Logic ğŸ”¥ CRITICAL
Duration: 3-4 days

3.1 Keyframe Creation
Click on timeline to add keyframe at playhead
Auto-detect property from current object state
Property selector dropdown (x, y, rotation, scaleX, scaleY, opacity)
Shortcut: K to add keyframe at playhead
Shortcut: Shift+K to add keyframe on all properties
3.2 Keyframe Manipulation
Drag keyframe left/right to adjust timing
Delete keyframe: Delete or right-click â†’ Delete
Copy/paste keyframes: Ctrl+C / Ctrl+V
Multi-select keyframes: Shift+Click or drag-select box
Bulk operations on selected keyframes
3.3 Easing Editor
File: client/src/components/editor/EasingEditor.tsx

Features:

Visual easing curve display
Preset easings (GSAP library):
none - Linear
power1.out, power2.out, power3.out, power4.out
back.out, elastic.out, bounce.out
circ.out, expo.out, sine.out
Custom cubic-bezier editor (advanced)
Preview animation with selected easing
3.4 Zero-Key (Default State)
Frame 0 automatically captures object's default state
Cannot be deleted (system keyframe)
Properties at frame 0 define starting values
Right-click object â†’ "Reset to Zero Key" to restore defaults
Phase 4: GSAP Timeline Engine ğŸ”¥ CRITICAL
Duration: 3-4 days

4.1 Timeline Builder Service
File: client/src/lib/timeline-builder.ts

interface TimelineBuilder {
  buildGSAPTimeline(animation: Animation, keyframes: Keyframe[]): gsap.core.Timeline;
  buildNestedTimeline(parentAnimation: Animation, childAnimations: Animation[]): gsap.core.Timeline;
  updateTimeline(timeline: gsap.core.Timeline, keyframes: Keyframe[]): void;
  addTimelineAction(parentTimeline: gsap.core.Timeline, action: TimelineAction): void;
}
Features:

Convert keyframes to GSAP timeline
Sort keyframes by time
Group keyframes by property
Apply easing per keyframe segment
Handle nested timelines (parent controls children)
4.2 Playback Controller
File: client/src/hooks/use-timeline-playback.ts

interface TimelinePlayback {
  play(): void;
  pause(): void;
  stop(): void;
  seek(time: number): void;
  setPlaybackRate(rate: number): void;
  getCurrentTime(): number;
  getDuration(): number;
  isPlaying: boolean;
}
4.3 Scrubbing Preview
Real-time preview as playhead drags
Update object transforms on each frame
Debounced rendering for performance
Visual feedback during scrub
Phase 5: Parent-Child Timeline Orchestration ğŸ¯ MEDIUM PRIORITY
Duration: 2-3 days

5.1 Timeline Action Editor
File: client/src/components/editor/TimelineActionEditor.tsx

Features:

Add "Play Child Timeline" action marker on parent timeline
Dropdown to select child object's timeline
Action types:
play - Start child timeline from current position
stop - Stop and reset child timeline
pause - Pause child timeline
restart - Reset and play from frame 0
gotoAndPlay(frame) - Jump to frame and play
gotoAndStop(frame) - Jump to frame and stop
Visual marker on timeline (e.g., flag icon)
Drag action marker to reposition trigger time
5.2 Nested Timeline Playback
When parent timeline plays, execute child actions at trigger times
Recursively play nested child timelines
Synchronize parent/child playback speeds
Handle circular references (error prevention)
5.3 Timeline Hierarchy Viewer
File: client/src/components/editor/TimelineHierarchy.tsx

Features:

Tree view of all object timelines in scene
Visual indicators for parent â†’ child relationships
Expand/collapse timeline groups
Quick navigation to timeline action markers
Phase 6: Advanced Animation Features ğŸ¨ MEDIUM PRIORITY
Duration: 3-4 days

6.1 Motion Path Editing
Draw bezier curve paths on canvas
Animate object along path
Path offset controls (start/end percentage)
Path rotation (align to path direction)
Visual path preview with control points
6.2 Onion Skinning
Toggle onion skin mode
Show previous/next frames as ghost overlays
Configurable frame range (e.g., Â±5 frames)
Opacity control for ghost frames
Color-coded before/after frames
6.3 Timeline Markers & Labels
Add named markers on timeline (e.g., "Intro", "Loop Start")
Color-coded labels
Jump to marker via dropdown
Use markers as action trigger points
6.4 Animation Presets Library
File: client/src/components/editor/AnimationPresetsPanel.tsx

Features:

Save custom animation presets
Apply preset to selected object
Built-in presets:
Fade In/Out
Bounce In/Out
Slide In/Out (from edges)
Rotate 360Â°
Scale Pulse
Elastic Wiggle
Preview preset before applying
Phase 7: Export & Integration ğŸš€ HIGH PRIORITY
Duration: 2-3 days

7.1 Activity Export Schema Extension
Update ActivityDefinition to include animations:

interface ActivityObject {
  // ... existing fields
  animations?: {
    id: string;
    duration: number;
    loop: boolean;
    autoplay: boolean;
    keyframes: {
      time: number;
      property: string;
      value: any;
      ease: string;
    }[];
    actions?: {
      action: string;
      targetObjectId: string;
      triggerTime: number;
      targetFrame?: number;
    }[];
  }[];
}
7.2 NACA Player Integration
Send animation data via DevSync WebSocket
Player builds GSAP timelines on runtime
Trigger animations based on scene changes
Support for vocabulary-driven animations (e.g., animate on correct answer)
7.3 Timeline Performance Optimization
Virtualized rendering for large timelines (1000+ keyframes)
Lazy-load keyframes outside viewport
Debounce keyframe updates during drag
Throttle playback preview during scrub
Keyboard Shortcuts
Add to DEFAULT_SHORTCUTS in use-keyboard-shortcuts.ts:

{ key: "k", action: "addKeyframe", description: "Add keyframe at playhead" },
{ key: "k", modifiers: ["shift"], action: "addKeyframeAll", description: "Add keyframe on all properties" },
{ key: " ", action: "playPause", description: "Play/Pause timeline" },
{ key: ",", action: "prevFrame", description: "Previous frame" },
{ key: ".", action: "nextFrame", description: "Next frame" },
{ key: "Home", action: "gotoStart", description: "Jump to start" },
{ key: "End", action: "gotoEnd", description: "Jump to end" },
{ key: "i", action: "setInPoint", description: "Set in-point" },
{ key: "o", action: "setOutPoint", description: "Set out-point" },
Dependency Graph
Phase 1: Data Layer & API
    â”‚
    â–¼
Phase 2: Timeline UI Components
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼               â–¼               â–¼
Phase 3:        Phase 4:        Phase 5:
Keyframe        GSAP            Parent-Child
Editing         Engine          Orchestration
    â”‚               â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
            Phase 6: Advanced Features
                    â”‚
                    â–¼
            Phase 7: Export & Integration
Implementation Priority Order
Phase 1 - Database & API foundation
Phase 2 - Timeline UI shell (allows visual development)
Phase 4 - GSAP engine (enables playback testing)
Phase 3 - Keyframe editing (makes timeline functional)
Phase 5 - Parent-child orchestration
Phase 7 - Export integration (NACA player compatibility)
Phase 6 - Advanced features (polish)
Technical Considerations
Performance
Use requestAnimationFrame for playback loop
Virtualized scrolling for timeline (React Window)
Memoize timeline rebuilds (only on keyframe changes)
Web Workers for heavy timeline calculations
State Management
Timeline state in useTimeline hook
Keyframe mutations via React Query
Optimistic updates for smooth UX
Undo/redo stack for keyframe edits
Accessibility
Keyboard navigation for timeline
Screen reader support for keyframe announcements
High contrast mode for timeline elements
Focus management during playback
File Structure
client/src/
â”œâ”€â”€ components/editor/
â”‚   â”œâ”€â”€ TimelinePanel.tsx          [Phase 2.1]
â”‚   â”œâ”€â”€ LayerTree.tsx              [Phase 2.2]
â”‚   â”œâ”€â”€ TimelineTrack.tsx          [Phase 2.3]
â”‚   â”œâ”€â”€ KeyframeLayer.tsx          [Phase 2.4]
â”‚   â”œâ”€â”€ PlayheadControls.tsx       [Phase 2.5]
â”‚   â”œâ”€â”€ EasingEditor.tsx           [Phase 3.3]
â”‚   â”œâ”€â”€ TimelineActionEditor.tsx   [Phase 5.1]
â”‚   â”œâ”€â”€ TimelineHierarchy.tsx      [Phase 5.3]
â”‚   â””â”€â”€ AnimationPresetsPanel.tsx  [Phase 6.4]
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ use-timeline.ts            [Phase 2]
â”‚   â”œâ”€â”€ use-timeline-playback.ts   [Phase 4.2]
â”‚   â””â”€â”€ use-keyframe-editor.ts     [Phase 3]
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ timeline-builder.ts        [Phase 4.1]
â”‚   â””â”€â”€ animation-presets.ts       [Phase 6.4]
server/
â”œâ”€â”€ db/schema/
â”‚   â””â”€â”€ animations.ts              [Phase 1.1]
â”œâ”€â”€ routes.ts                      [Phase 1.3]
â””â”€â”€ storage.ts                     [Phase 1.2]
shared/
â””â”€â”€ schema.ts                      [Phase 7.1]
Testing Strategy
Unit Tests: Timeline builder logic, keyframe sorting, easing calculations
Integration Tests: GSAP timeline generation, nested timeline playback
E2E Tests: Full animation workflow (create keyframes â†’ preview â†’ export)
Performance Tests: 1000+ keyframe timeline rendering, playback smoothness
Risks & Mitigations
Risk	Mitigation
GSAP timeline rebuilds cause jank	Debounce rebuilds, use timeline.invalidate() for updates
Nested timelines create circular references	Validate parent-child relationships, prevent cycles
Large timelines slow down UI	Virtualized rendering, lazy-load keyframes
Keyframe precision issues (floating point)	Round times to frame boundaries (e.g., 1/60s)
Success Metrics
Timeline loads in <200ms for 500 keyframes
Playback maintains 60fps for animations with 50+ layers
Keyframe editing feels instant (optimistic updates)
Export includes all animation data for NACA player
Users can create complex animations without performance degradation
This plan provides a complete roadmap for building an Adobe Animate-equivalent animation system. The phased approach ensures that foundational work (data layer, UI shell) is completed before advanced features, minimizing rework and enabling iterative testing.